<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6"
      layout:decorate="~{layout}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <title>Dashboard Admin - PeriTech</title>
</head>
<body>
<div layout:fragment="content">
    <!-- Header -->
    <div class="bg-white shadow-sm">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">Dashboard Administrativo</h1>
                    <p class="text-gray-600 mt-2">Resumen general y métricas del sistema</p>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-500" th:text="${#temporals.format(#temporals.createNow(), 'dd/MM/yyyy HH:mm')}"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Métricas Principales -->
    <div class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Total Productos -->
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Productos Activos</p>
                        <p class="text-3xl font-bold text-gray-800" th:text="${totalProductos}">0</p>
                    </div>
                    <div class="text-blue-500 text-2xl">
                        <i class="fas fa-box"></i>
                    </div>
                </div>
                <div class="mt-2">
                    <a th:href="@{/admin/productos}" class="text-blue-600 hover:text-blue-800 text-sm font-semibold">
                        Gestionar productos <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
            </div>

            <!-- Total Usuarios -->
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Usuarios Registrados</p>
                        <p class="text-3xl font-bold text-gray-800" th:text="${totalUsuarios}">0</p>
                    </div>
                    <div class="text-green-500 text-2xl">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
                <div class="mt-2">
                    <a th:href="@{/admin/usuarios}" class="text-green-600 hover:text-green-800 text-sm font-semibold">
                        Ver usuarios <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
            </div>

            <!-- Pedidos Entregados -->
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-purple-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Pedidos Entregados</p>
                        <p class="text-3xl font-bold text-gray-800" th:text="${totalPedidos}">0</p>
                    </div>
                    <div class="text-purple-500 text-2xl">
                        <i class="fas fa-shopping-bag"></i>
                    </div>
                </div>
                <div class="mt-2">
                    <a th:href="@{/admin/pedidos}" class="text-purple-600 hover:text-purple-800 text-sm font-semibold">
                        Ver pedidos <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
            </div>

            <!-- Ingresos Totales -->
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-yellow-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Ingresos (Último Mes)</p>
                        <p class="text-3xl font-bold text-gray-800"
                           th:text="'$' + ${#numbers.formatDecimal(ingresosTotales, 1, 2)}">$0.00</p>
                    </div>
                    <div class="text-yellow-500 text-2xl">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                </div>
                <div class="mt-2">
                    <a th:href="@{/admin/estadisticas}" class="text-yellow-600 hover:text-yellow-800 text-sm font-semibold">
                        Ver estadísticas <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Pedidos Recientes -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-gray-800">Pedidos Recientes</h2>
                        <a th:href="@{/admin/pedidos}" class="text-blue-600 hover:text-blue-800 text-sm font-semibold">
                            Ver todos
                        </a>
                    </div>

                    <div th:if="${pedidosRecientes != null and !pedidosRecientes.empty}">
                        <div class="space-y-4">
                            <div th:each="pedido : ${pedidosRecientes}"
                                 class="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition duration-300">
                                <div class="flex items-center space-x-4">
                                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-shopping-bag text-blue-600"></i>
                                    </div>
                                    <div>
                                        <p class="font-semibold text-gray-800" th:text="'Pedido #' + ${pedido.id}"></p>
                                        <p class="text-gray-600 text-sm"
                                           th:text="${#temporals.format(pedido.fechaPedido, 'dd/MM/yyyy HH:mm')}"></p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span th:class="${{
                                        'PENDIENTE': 'bg-yellow-100 text-yellow-800',
                                        'CONFIRMADO': 'bg-blue-100 text-blue-800',
                                        'EN_PREPARACION': 'bg-orange-100 text-orange-800',
                                        'ENVIADO': 'bg-purple-100 text-purple-800',
                                        'ENTREGADO': 'bg-green-100 text-green-800',
                                        'CANCELADO': 'bg-red-100 text-red-800'
                                    }[pedido.estado.name()]}"
                                          class="px-2 py-1 rounded-full text-xs font-semibold"
                                          th:text="${pedido.estado}">
                                    </span>
                                    <p class="text-gray-800 font-semibold mt-1"
                                       th:text="'$' + ${#numbers.formatDecimal(pedido.total, 1, 2)}"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div th:if="${pedidosRecientes == null or pedidosRecientes.empty}" class="text-center py-8">
                        <i class="fas fa-shopping-bag text-4xl text-gray-300 mb-4"></i>
                        <p class="text-gray-600">No hay pedidos recientes</p>
                    </div>
                </div>
            </div>

            <!-- Acciones Rápidas -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-6">Acciones Rápidas</h2>

                    <div class="space-y-4">
                        <a th:href="@{/admin/productos}"
                           class="flex items-center justify-between p-4 bg-blue-50 rounded-lg hover:bg-blue-100 transition duration-300 group">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-box text-blue-600 text-xl"></i>
                                <span class="font-semibold text-gray-800">Gestionar Productos</span>
                            </div>
                            <i class="fas fa-arrow-right text-blue-600 group-hover:translate-x-1 transition-transform"></i>
                        </a>

                        <a th:href="@{/admin/categorias}"
                           class="flex items-center justify-between p-4 bg-green-50 rounded-lg hover:bg-green-100 transition duration-300 group">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-tags text-green-600 text-xl"></i>
                                <span class="font-semibold text-gray-800">Gestionar Categorías</span>
                            </div>
                            <i class="fas fa-arrow-right text-green-600 group-hover:translate-x-1 transition-transform"></i>
                        </a>

                        <a th:href="@{/admin/usuarios}"
                           class="flex items-center justify-between p-4 bg-purple-50 rounded-lg hover:bg-purple-100 transition duration-300 group">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-users text-purple-600 text-xl"></i>
                                <span class="font-semibold text-gray-800">Gestionar Usuarios</span>
                            </div>
                            <i class="fas fa-arrow-right text-purple-600 group-hover:translate-x-1 transition-transform"></i>
                        </a>

                        <a th:href="@{/admin/estadisticas}"
                           class="flex items-center justify-between p-4 bg-yellow-50 rounded-lg hover:bg-yellow-100 transition duration-300 group">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-chart-bar text-yellow-600 text-xl"></i>
                                <span class="font-semibold text-gray-800">Ver Estadísticas</span>
                            </div>
                            <i class="fas fa-arrow-right text-yellow-600 group-hover:translate-x-1 transition-transform"></i>
                        </a>
                    </div>

                    <!-- Información del Sistema -->
                    <div class="mt-8 pt-6 border-t border-gray-200">
                        <h3 class="font-semibold text-gray-800 mb-4">Información del Sistema</h3>
                        <div class="space-y-2 text-sm text-gray-600">
                            <div class="flex justify-between">
                                <span>Versión:</span>
                                <span class="font-semibold">v1.0.0</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Última actualización:</span>
                                <span class="font-semibold" th:text="${#temporals.format(#temporals.createNow(), 'dd/MM/yyyy')}"></span>
                            </div>
                            <div class="flex justify-between">
                                <span>Estado:</span>
                                <span class="font-semibold text-green-600">Operativo</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script layout:fragment="scripts">
    document.addEventListener('DOMContentLoaded', function() {
        // Actualizar métricas en tiempo real
        function actualizarMetricas() {
            // Aquí podrías implementar actualizaciones en tiempo real con AJAX
            console.log('Actualizando métricas...');
        }

        // Actualizar cada 5 minutos
        setInterval(actualizarMetricas, 300000);
    });
</script>
</body>
</html>